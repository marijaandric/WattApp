<standard-template>
  <app-title-bar>
    <h3>Prosumer</h3>
  </app-title-bar>

    <!-- optional -->
  <app-select-one-menu-bar>
   <app-tab-menu-users></app-tab-menu-users>
  </app-select-one-menu-bar>

  <app-center-bar *ngIf="loader"><app-loader></app-loader></app-center-bar>
    <app-center-bar *ngIf="!loader">
  <div  class="main-grid"> 
    <app-map [users] = "getUserDTOs(users)" style="
      height: 79.2vh;
      width:38%; display: flex;
      float:left;
      flex-direction: column;">
    </app-map>

    <div style="display:flex;float:right; flex-direction:column; width:60%; height:100%">
      <div style="display:flex;float:right; flex-direction:row; width:100%; height:fit-content; margin-bottom:32px;" class="pdd-div">
        <div style="display:flex;float:right; flex-direction:column;  width:48%; height:100%" >
          
  
  <p-dropdown [options]="type" appendTo="body" (onChange)="onDropdownChange2()" [(ngModel)]="selectedType" optionLabel="name" >
  </p-dropdown>
        </div>
        <div style="display:flex;float:right; flex-direction:column; margin-left:calc(3%); width:48%; height:100%" >
          
          <p-dropdown [options]="options" (onChange)="onDropdownChange()" appendTo="body" [(ngModel)]="selectedOption" optionLabel="name"  >
          </p-dropdown>
        </div>
      </div>
      <div style="display:flex;float:right; flex-direction:row; width:100%; height:400px">
        <div style="display:flex;float:right; flex-direction:column;  width:48%; height:100%" >
          <app-single-area-pie [Series]="values" [chartLabels]="keys"></app-single-area-pie>
        </div>
        <div style="display:flex;float:right; flex-direction:column; margin-left:calc(3.5%); width:49%; height:100%" >
          <app-all-areas-donut [Series]="count" [chartText]="naziv"  [chartHeight]="100"></app-all-areas-donut>
        </div>
      </div>

      <div style="display:flex;float:right; flex-direction:row; width:100%; height:100%">
        <p-table class="d-table" #dtUsers class="ui-table-default" [value]="users" dataKey="id" [scrollable]="true" 
          [rows]="rowsPerPage" [totalRecords]="allUsersCount" [lazy]="true" 
          (onSort)="customSort($event)" [customSort]="true"
          [showCurrentPageReport]="true" (onPage)="onPageChange($event)"
          [globalFilterFields]="['id','firstName','address','consumption','production', 'stock']" [paginator]="true" 
          style="
            margin-top:calc(3.5%);
            display: flex;
            position: relative;
            flex-direction: column;
            height: fit-content;
            width: 100%;
            border-radius: 20px;
            background: linear-gradient(180deg, #151515 50%, #121212 100%) ;
            box-shadow: 5px 5px 15px black;
            transition: ease-in-out;
            padding:10px 20px;
            ">

            <ng-template pTemplate="caption">
              <div class="flexRow">
                  <h3 >
                  Users</h3>
                  <span class="p-input-icon-left margin-left__auto margin-right__16px">
                      <i class="pi pi-search"></i>
                      <input pInputText type="text" (input)="dtUsers.filterGlobal($any($event.target).value, 'contains')" placeholder="Search keyword" />
                  </span>
                  <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear(dtUsers)"></button>
              </div>
            </ng-template>

            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="firstName" style="min-width:8rem;  border-top:2px solid #46c5f1; border-bottom:2px solid #46c5f1;">
                  <div class="flexRow">
                      <p style=" font-size: 18px !important;">Name</p>
                      <p-sortIcon field="firstName"></p-sortIcon>
                      <p-columnFilter class="ml-auto" type="text" field="firstName" display="menu"></p-columnFilter>
                  </div>
                </th>
                <th pSortableColumn="address" style="min-width:9rem;  border-top:2px solid #46c5f1; border-bottom:2px solid #46c5f1;">
                  <div class="flexRow">
                      <p style=" font-size: 18px !important;">Address</p>
                      <p-sortIcon field="address"></p-sortIcon>
                      <p-columnFilter class="ml-auto" type="text" field="address" display="menu"></p-columnFilter>
                  </div>
                </th>
                <th pSortableColumn="consumption" style="min-width:10rem;  border-top:2px solid #46c5f1; border-bottom:2px solid #46c5f1;">
                  <div class="flexRow">
                      <p style=" font-size: 18px !important;">Monthly consumption</p>
                      <p-sortIcon field="consumption"></p-sortIcon>
                      <p-columnFilter class="ml-auto" type="text" field="consumption" display="menu"></p-columnFilter>
                  </div>
                </th>
                <th pSortableColumn="production" style="min-width:8rem; border-top:2px solid #46c5f1; border-bottom:2px solid #46c5f1;">
                  <div class="flexRow">
                      <p style=" font-size: 18px !important;">Monthly production</p>
                      <p-sortIcon field="production"></p-sortIcon>
                      <p-columnFilter class="ml-auto" type="text" field="production" display="menu"></p-columnFilter>
                  </div>
                </th>
                <th pSortableColumn="stock" style="min-width:8rem; border-top:2px solid #46c5f1; border-bottom:2px solid #46c5f1;">
                  <div class="flexRow">
                      <p style=" font-size: 18px !important;">Monthly stock</p>
                      <p-sortIcon field="stock"></p-sortIcon>
                      <p-columnFilter class="ml-auto" type="text" field="stock" display="menu"></p-columnFilter>
                  </div>
                </th>
              </tr>
            </ng-template>

              <ng-template pTemplate="body" let-user>
                <tr routerLink="/userDSO/{{user.id}}">
                  <td><div style="width:20%;position:relative;float:left"><img src="{{ baseUrl + user.id }}" class="rounded-circle" width="25px" height="25px" style="margin-right: 10%"></div><div style="width:70%;position:relative;float:right">{{user.user.firstName}} {{user.user.lastName}}</div> </td>
                  <td>{{user.user.address}}</td>
                  <td>{{user.production}}</td>
                  <td>{{user.consumption}}</td>
                  <td>{{user.stock}}</td>
                </tr>
              </ng-template>

              <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="5">No users found.</td>
                </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </app-center-bar>
</standard-template>
