<div *ngIf="loader"><app-loader></app-loader></div>

<div *ngIf="!loader" class="device" >
    <div class="top-card">
        
    <div class="widgets">       
        <app-widget [subTitle]="SubTitleToday" [Title]="Today +' kW/h'" [isBlue]="true" [isBgBlue]="true" class="widget">
        </app-widget>
        <app-widget [subTitle]="SubTitleWeek" [Title]="Week+' kW/h'" [isYellow]="true" [isBgYellow]="true" class="widget">
        </app-widget>
        <app-widget [subTitle]="SubTitleMonth" [Title]="Month+' kW/h'" [isPink]="true" [isBgPink]="true" class="widget">
        </app-widget>
        <app-widget  [subTitle]="SubTitleYear" [Title]="Year+' kW/h'" [isOrange]="true" [isBgOrange]="true" class="widget">
        </app-widget>
        <app-widget  [subTitle]="SubTitleAll" [Title]="Year+' kW/h'" [isBlue]="true" [isBgBlue]="true" class="widget" >
        </app-widget>
      </div>
    
      </div> 
    <div class="circles">
        <div class="main-card">
            <div class="card-1">
                <div class="flexRow">
                    <div class="icon-1">
                        <i class="fa-solid fa-tv"></i>
                    </div>

                    <div class="colored-text" >
                        <h5>{{device.deviceName}}</h5>
                    </div>
                    <div style="margin-top:20px;" class="margin-left__auto">
                        <p-inputSwitch [(ngModel)]="device.isActive "  (onChange)="handleRunningSwitchChange()" class=" width__fit-content"></p-inputSwitch>
                    </div>
                </div>
                <div class="title1" style="margin-bottom:20px;">
                    <h5>Consumption this hour</h5>
                </div>
        
                <div class=" circle circle-1">
                    <div class="circle circle-2">
                        <div class="circle-icon">
                            <i class="fa-solid fa-bolt"></i>
                        </div>
    
                        <div class="main-stat">
                            <span>{{power}}</span> 
                        </div>
    
                        <div class="kwh">
                            <span>kWh</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>  
    
    <div class="info" >
        <div id="deviceInformation" class="flexColumn device-information" >
            <div class="flexRow">
                <div class="colored-text2" ><h5>Device description</h5></div>
            </div>
    
            <div class="flexRow margin-top__16px">
            <span>ID:</span>
            <span class="margin-left__auto text-secondary">{{ device.id }}</span>
            </div>
    
            <div class="flexRow margin-top__8px">
            <span>Model:</span>
            <span class="margin-left__auto text-secondary">{{ device.deviceModel }}</span>
            </div>
    
            <div class="flexRow margin-top__8px">
            <span >Type:</span>
            <span class="margin-left__auto text-secondary">{{ device.deviceType }}</span>
            </div>
    
            <div class="flexRow margin-top__8px">
            <span>Room:</span>
            <span class="margin-left__auto text-secondary">{{ device.room }}</span>
            </div>
    
            <div class="flexRow margin-top__16px">
            <span >Visible to operators:</span>
            <p-inputSwitch [(ngModel)]="device.allowOperatorVisibility" (ngModelChange)="promijeniStanjeprviPrekidac()"  (onChange)="handleVisibilitySwitchChange()" class="margin-left__auto width__fit-content"/>
            </div>
    
            <div class="flexRow margin-top__8px">
            <span >Managed by operators:</span>
            <p-inputSwitch [(ngModel)]="device.allowOperatorControll" (ngModelChange)="promijeniStanjeDrugiPrekidac()"  (onChange)="handleManagementSwitchChange()" class="margin-left__auto width__fit-content"/>
            </div>

            <div class="flexRow margin-top__8px">
                <p-button label="Edit" (click)="showEditDeviceDialog()" class="margin-left__auto"/>
                <p-button label="Schedule" class="margin-left__8px"/>
                <p-button label="Delete" (onClick)="deleteDevice(device.id)" class="margin-left__8px"/>
              </div> 
        </div>
    </div>

    <div class="display:flex;position:relative; width:100%; height:fit-content;flex-direction:row;">
        <div style="width:100%; height:fit-content; display:flex; flex-direction:row;margin-bottom:12px;">
            <p-dropdown [options]="type2" appendTo="body" [(ngModel)]="selectedHF"  optionLabel="name" (onChange)="updateType3()" style="width:calc(50% - 10px) !important;">
            </p-dropdown>
            <p-dropdown [options]="type3" appendTo="body" [(ngModel)]="selectedDate" optionLabel="name" (onChange)="dropdownChange()" style="width:calc(50% - 10px) !important;margin-left:20px;">
            </p-dropdown>
          </div>
    </div>


    <div class="circles" >    
        <div class="card-2">
            <div class="card-2-1" >
                <div class="stats">
                    <div style="width:100%; height:fit-content; position:relative;">
                        
                        <div class="subtitle-card">
                            <span>{{TitleMin}}</span>
                        </div>
                    </div>
                    <div style="width:100%; height:fit-content; position:relative;">
                        <div class="main-stat-card">
                            <span>{{min}}</span> 
                        </div>

                        <div class="kwh-card">  
                            <span>kWh</span>
                        </div>
                    </div>

                    <div class="subtitle-2">  
                        <span>{{theDay}} {{dataMin}}</span>
                    </div>
                </div>
            </div>
            <div class="card-2-2" >
                <div class="stats">
                    <div style="width:100%; height:fit-content; position:relative;">
                        
                        <div class="subtitle-card">
                            <span>{{TittleMax}}</span>
                        </div>
                    </div>

                    <div style="width:100%; height:fit-content; position:relative;">
                        <div class="main-stat-card">
                            <span>{{max}}</span> 
                        </div>

                        <div class="kwh-card">  
                            <span>kWh</span>
                        </div>
                    </div>

                    <div class="subtitle-2">  
                        <span>{{theDay}} {{dataMax}}</span>
                    </div>
                </div>
            </div>   
        </div>
        
        <div class="card-2 card-3" style="margin-bottom: 30px;">
            <div class="card-2-1" >
                <div class="stats">
                    <div style="width:100%; height:fit-content; position:relative;">
                       
                        <div class="subtitle-card">
                            <span>{{TitleAverage}}</span>
                        </div>
                    </div>

                    <div style="width:100%;  position:relative;">
                        <div class="main-stat-card">
                            <span>{{average}}</span> 
                        </div>

                        <div class="kwh-card">  
                            <span>kWh</span>
                        </div>
                    </div>

                 
                </div>
            </div>
                
            <div  class="card-2-2" >
                <div class="stats">
                    <div style="width:100%; height:fit-content; position:relative;">
                      

                        <div class="subtitle-card">
                            <span>{{TitleTotal}}</span>
                        </div>
                    </div>

                    <div style="width:100%; height:fit-content; position:relative;">
                        <div class="main-stat-card">
                            <span>{{total}}</span> 
                        </div>

                        <div class="kwh-card">  
                            <span>kWh</span>
                        </div>
                    </div>

    
                </div>
            </div>   
        </div>
    </div>
    
    <div class="twoCharts" *ngIf="tableHiFWeek" style="position:relative">
        <p-selectButton class="flexRow width__fit-content margin-left__auto" style="margin-bottom:20px;margin-top:20px !important;position:relative" [options]="switchOptions" [(ngModel)]="switchValue" optionLabel="label" optionValue="value"></p-selectButton>
        <app-history-line-chart #myChart2 class="handf" *ngIf="switchValue == true" [array] = 'miniHistory' [array2] = 'miniarrayData1'></app-history-line-chart>
        <app-forecast-line-chart #myChart1 class="handf" *ngIf="switchValue == false"  [array]="miniForecast" [array2] = 'miniarrayData2'></app-forecast-line-chart>
    </div>
    <div class="twoCharts" *ngIf="!tableHiFWeek">
        <app-history-forecast style="width: 100%;
        background: linear-gradient(180deg, #151515 50%, #0d0d0d 100%)  !important;" [boja1]="color1" [boja2]="color2" [naziv1]="name" [naziv2]="name" [array] = "History" [array2]="Forecast" [array3] = "dates" class="chart"></app-history-forecast>
    </div>

    
    <app-history-forecast-table *ngIf="table"
        style="
        margin-top:32px;
        display: flex;
        position: relative;
        flex-direction: column;
        height: fit-content;
        border-radius: 20px;
        background: linear-gradient(180deg, #151515 50%, #0d0d0d 100%) ;
        box-shadow: 5px 5px 15px black;
        transition: ease-in-out;
        padding:10px 20px 30px 20px;
        " [name1]="name" [name2]="name" [hif]="hif"></app-history-forecast-table>
        <app-history-or-forecast-table  *ngIf="!table"
        style="
          margin-top:32px;
          display: flex;
          position: relative;
          flex-direction: column;
          height: fit-content;
          width: 100%;
          border-radius: 20px;
          background: linear-gradient(180deg, #151515 50%, #121212 100%) ;
          box-shadow: 5px 5px 15px black;
          transition: ease-in-out;
          padding:10px 20px 30px 20px;"  [name]="name" [History]="History" [Forecast]="Forecast" [dates]="dates" >
          </app-history-or-forecast-table>

    

          <div class="display:flex;position:relative; width:100%; height:fit-content;flex-direction:row;">
            <div style="width:100%; height:fit-content; display:flex; flex-direction:row;margin-bottom:20px;margin-top:20px;">
                <p-dropdown [options]="type2" appendTo="body" [(ngModel)]="selectedHF"  optionLabel="name" (onChange)="updateType3()" style="width:calc(50% - 10px) !important;">
                </p-dropdown>
                <p-dropdown [options]="type3" appendTo="body" [(ngModel)]="selectedDate" optionLabel="name" (onChange)="dropdownChange()" style="width:calc(50% - 10px) !important;margin-left:20px;">
                </p-dropdown>
              </div>
        </div>
</div>
   





<p-dialog id="editDeviceDialogId" [style]="{width:'40%'}"
  [draggable]="false" [keepInViewport]="true" [resizable]="false" 
  [blockScroll]="true" [closeOnEscape]="true" 
  [modal]="true" [(visible)]="displayEditDeviceDialog" [breakpoints]="{'960px': '75vw', '640px': '90vw'}"
  [closable]="true" >
  <ng-template pTemplate="header" class="header-dialog">
    <span>Edit device</span>
  </ng-template>
  
  <ng-template pTemplate="content">
    <form id="editDeviceDialogForm" >  
      <div class="p-inputgroup p-inputtext-lg p-input-filled">
        <div class="half">
          Device type
          <p-dropdown [options]="types" [(ngModel)]="typeSelected" name="typeSelected" appendTo="body" optionLabel="name" />
          Device model
          <p-dropdown [options]="models" [(ngModel)]="modelSelected" name="modelSelected" appendTo="body" optionLabel="name" />
        </div> 
        
        <div class="half">
            Room
          <p-dropdown [options]="rooms" [(ngModel)]="roomSelected" name="roomSelected" appendTo="body" optionLabel="name" />
            Name
          <input style="margin-top:45px;" [(ngModel)]="nameSelected" name="nameSelected" appendTo="body" type="text" class="p-inputtext-lg" placeholder="DEVICE NAME"> 
        </div>
      </div> 
    </form>
  </ng-template>

  <ng-template pTemplate="footer" >
    <div class="flexRow">
      <button style="margin-right: 0px;" (click)="save()" type="submit">Save</button>
      <button class="margin-left__16px" (click)="cancel()" type="submit">Cancel</button>
    </div>
  </ng-template>
</p-dialog>


<p-dialog [style]="{width:'20%'}" header="Title"  [transitionOptions]="'3ms'" 
[draggable]="false" [keepInViewport]="true" [resizable]="false" 
[blockScroll]="true" [closeOnEscape]="true" [dismissableMask]="true" 
[modal]="true" [(visible)]="display3" [breakpoints]="{'960px': '75vw', '640px': '90vw'}"
[closable]="true" >
<ng-template pTemplate="header" class="header-dialog">
  <span>Delete device</span>
</ng-template>

<ng-template pTemplate="center">
  <div class="delete-device-content">
    Are you sure you want to erase the device?
    All data will be deleted and you will not be able to recover it.

  </div>
</ng-template>

<ng-template pTemplate="footer" >
  <button type="button" class="no-button" icon="fa-home" label="No" (click)="showDialog()"><span clas="no-span">No</span></button>
  <button type="button" class="yes-button" icon="pi pi-info-circle" label="Yes" (click)="deleteDevice(device.id)"><span clas="no-span">Yes</span></button>

</ng-template>
</p-dialog>